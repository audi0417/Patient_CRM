# 預約拖曳功能說明

## 功能概述

您現在可以在預約行事曆中直接拖曳預約卡片到新的日期，輕鬆修正或重新安排預約時間。

## 新增功能

### 1. **日期單元格高度增加**
- **從 140px 增加到 200px**
- 提供更多空間顯示預約詳細資訊

### 2. **預約卡片顯示更多內容**
- ✅ **預約時間** (例：14:30)
- ✅ **患者名稱**
- ✅ **預約類型** (例：初診、複診)
- ✅ **狀態徽章** (已預約、已完成、已取消)

### 3. **拖曳功能**
- **滑鼠光標變化**：
  - 懸停時顯示 `cursor-grab` (抓取手指)
  - 拖曳中顯示 `cursor-grabbing` (正在抓取)
  
- **拖曳提示**：
  - 預約卡片左側有 **grip 圖示**，表示可拖曳
  - 拖曳時卡片透明度降至 50%

- **放置區域反饋**：
  - 將預約拖到新日期時，該日期單元格會：
    - 背景變亮 (`bg-accent/70`)
    - 邊框變成 **2px 藍色** (`border-primary`)

### 4. **拖曳預約的步驟**
1. 在任何預約卡片上按住滑鼠左鍵
2. 將卡片拖到目標日期的日期單元格
3. 當日期單元格反應亮起時，鬆開滑鼠
4. 預約會自動更新到新日期

### 5. **垂直捲動支援**
- 每個日期單元格內有 **150px 的捲動區域**
- 可查看該日期所有預約（不限於顯示前 3 個）

## 技術實現

### 使用的技術
- **HTML5 拖拽 API** (`draggable` 屬性)
- **React Hooks** (useState, useEffect)
- **date-fns** 日期處理

### 主要修改檔案
- `src/components/CustomCalendar.tsx`

### 核心功能

#### 拖拽開始 (`onDragStart`)
```tsx
onDragStart={(e) => {
  e.dataTransfer!.effectAllowed = "move";
  e.dataTransfer!.setData("appointmentId", apt.id);
  e.currentTarget.style.opacity = "0.5";
}}
```

#### 放置處理 (`onDrop`)
```tsx
onDrop={async (e) => {
  e.preventDefault();
  const appointmentId = e.dataTransfer?.getData("appointmentId");
  // 更新預約日期並保存
  const updatedAppointment = {
    ...appointment,
    date: targetDate
  };
  await saveAppointment(updatedAppointment);
}}
```

## 使用範例

### 場景 1：修正預約日期
如果患者因故需要改期，直接拖曳其預約卡片到新日期：
1. 找到預約卡片
2. 點擊並按住卡片
3. 拖到新日期
4. 鬆開滑鼠 → 完成！

### 場景 2：檢查特定日期預約
如果某日期預約很多，使用捲動查看：
1. 點擊該日期單元格
2. 在 150px 的捲動區域內上下拖動
3. 查看所有預約

## 樣式優化

### 預約卡片顏色
| 狀態 | 顏色 | 邊框 |
|------|------|------|
| 已預約 (scheduled) | 藍色 50 | 藍色 400 |
| 已完成 (completed) | 綠色 50 | 綠色 400 |
| 已取消 (cancelled) | 紅色 50 | 紅色 400 |

### 暗黑模式支援
所有顏色均已適配暗黑模式 (`dark:` 前綴類別)

## 驗證清單

- [x] 日期單元格高度從 140px 增加至 200px
- [x] 預約卡片顯示時間、患者、類型
- [x] 支援拖曳預約到新日期
- [x] 拖曳時自動保存變更
- [x] 提供視覺反饋（光標、背景色、邊框）
- [x] 支援暗黑模式
- [x] 錯誤處理和載入狀態

## 已知限制

1. **拖曳同一日期**：如果拖到相同日期，不會觸發更新
2. **離線時**：如果網路連線中斷，拖曳可能失敗（需顯示錯誤訊息）
3. **定期回診**：目前只更新單個預約日期，不影響整個系列

## 未來改進

- [ ] 實時拖曳預覽（顯示實時位置提示）
- [ ] 批量編輯（多選預約一起拖曳）
- [ ] 撤銷功能（Ctrl+Z 恢復拖曳）
- [ ] 週視圖和月視圖切換
- [ ] 拖曳預約到不同時間槽

## 問題排除

### 拖曳無反應？
1. 確保預約卡片上有 **grip 圖示**
2. 檢查瀏覽器是否支援 HTML5 拖拽
3. 查看瀏覽器控制台是否有錯誤信息

### 放置失敗？
1. 確保目標日期單元格亮起（背景色改變）
2. 檢查網路連線狀態
3. 查看儲存是否成功

---

**最後更新**：2025年11月10日
**版本**：1.0.0
