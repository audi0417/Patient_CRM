# 模組化功能管理指南

## 概述

Patient CRM 系統現已支援模組化功能管理，允許超級管理員為每個組織客製化啟用的功能模組。這讓您可以根據不同客戶需求提供不同的功能組合。

## 可用模組

系統提供以下5個功能模組：

### 1. 健康數據管理 (healthData)
- **功能**: 體組成記錄、生命徵象追蹤
- **預設狀態**: 啟用
- **適用對象**: 健身房、醫療診所、健康管理中心

### 2. 健康目標管理 (goals)
- **功能**: 設定和追蹤健康目標
- **預設狀態**: 啟用
- **適用對象**: 健身教練、營養師、復健中心

### 3. 諮詢記錄 (consultations)
- **功能**: 客戶諮詢記錄管理
- **預設狀態**: 啟用
- **適用對象**: 診所、諮詢顧問、專業服務

### 4. 預約管理 (appointments)
- **功能**: 預約排程與提醒
- **預設狀態**: 啟用
- **適用對象**: 所有需要預約系統的組織

### 5. 數據分析 (analytics)
- **功能**: 健康數據趨勢分析與報表
- **預設狀態**: 停用
- **適用對象**: 進階方案客戶

## 如何使用

### 超級管理員操作

1. **登入超級管理員帳號**
   - 帳號: `superadmin`
   - 密碼: `admin123`

2. **進入企業管理頁面**
   - 點擊頂部選單的「企業管理」

3. **開啟模組設定**
   - 在組織列表中，找到要設定的組織
   - 點擊該組織列的「齒輪圖示」（設定圖示）

4. **調整模組設定**
   - 在彈出的對話框中，可以看到所有可用模組
   - 使用開關按鈕啟用或停用各個模組
   - 點擊「儲存設定」完成

### 模組影響範圍

當模組被停用後：
- **後端 API**: 該組織的使用者無法存取相關 API，會收到 `MODULE_DISABLED` 錯誤
- **前端介面**: 相關選單項目會自動隱藏
- **Super Admin**: 不受模組限制，可存取所有功能

### API 端點

#### 獲取可用模組列表（超級管理員）
```
GET /api/organizations/modules/available
```

#### 獲取組織的模組配置（超級管理員）
```
GET /api/organizations/:id/modules
```

#### 更新組織的模組配置（超級管理員）
```
PUT /api/organizations/:id/modules
Body: {
  "modules": {
    "healthData": {
      "enabled": false,
      "name": "健康數據管理",
      "features": ["body_composition", "vital_signs"]
    },
    ...
  }
}
```

#### 獲取當前使用者的模組配置
```
GET /api/modules
```

## 商業應用範例

### 方案 A：基礎健康管理
- ✅ 健康數據管理
- ✅ 預約管理
- ❌ 健康目標管理
- ❌ 諮詢記錄
- ❌ 數據分析

**適用**: 小型診所、基礎健康檢查中心

### 方案 B：專業諮詢服務
- ❌ 健康數據管理
- ✅ 健康目標管理
- ✅ 諮詢記錄
- ✅ 預約管理
- ❌ 數據分析

**適用**: 營養諮詢、心理諮商、職業諮詢

### 方案 C：完整健康管理（企業版）
- ✅ 健康數據管理
- ✅ 健康目標管理
- ✅ 諮詢記錄
- ✅ 預約管理
- ✅ 數據分析

**適用**: 大型健康管理中心、企業健康方案

## 技術實作

### 後端保護

所有需要模組權限的路由都使用 `requireModule()` 中介軟體：

```javascript
const { requireModule } = require('../middleware/moduleAccess');

router.use(authenticateToken);
router.use(requireModule('healthData'));
```

### 前端檢查

使用 `useModules` Hook 檢查模組狀態：

```typescript
const { isModuleEnabled } = useModules();

{isModuleEnabled('healthData') && (
  <Link to="/health-analytics">健康數據</Link>
)}
```

## 注意事項

1. **資料完整性**: 停用模組不會刪除相關資料，重新啟用後資料會恢復可見
2. **Super Admin**: 超級管理員不受模組限制，可存取所有功能
3. **即時生效**: 模組設定更新後立即生效，使用者下次 API 請求時就會套用新設定
4. **降級處理**: 如果前端無法獲取模組配置，會預設所有模組為啟用狀態

## 未來擴展

未來可以考慮新增以下模組：
- 庫存管理
- 財務報表
- 行銷自動化
- 會員積分系統
- 電子商務整合
