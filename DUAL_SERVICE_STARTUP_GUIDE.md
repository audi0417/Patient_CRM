# é›™æœå‹™å•Ÿå‹•æŒ‡å— - Frontend + Backend

## ğŸ“Œ æ¶æ§‹èªªæ˜

æ‚¨çš„ Patient CRM ç³»çµ±ç”±å…©å€‹éƒ¨åˆ†çµ„æˆï¼š

### 1ï¸âƒ£ å‰ç«¯ (React + Vite)
```
ä½ç½®: /src
æ§‹å»º: npm run build â†’ /dist
æ–‡ä»¶: éœæ…‹ HTML/CSS/JS
é‹è¡Œæ–¹å¼: Express éœæ…‹æ–‡ä»¶æœå‹™
ç«¯å£: 3001 (èˆ‡å¾Œç«¯å…±äº«)
```

### 2ï¸âƒ£ å¾Œç«¯ (Node.js + Express)
```
ä½ç½®: /server
é¡å‹: RESTful API
ç«¯å£: 3001
æ•¸æ“šåº«: SQLite æˆ– PostgreSQL
é‹è¡Œæ–¹å¼: Express ä¼ºæœå™¨
```

---

## ğŸš€ Zeabur å¦‚ä½•è‡ªå‹•å•Ÿå‹•

### âœ… æ˜¯çš„ï¼ŒZeabur æœƒè‡ªå‹•å•Ÿå‹•ï¼

ç•¶æ‚¨éƒ¨ç½²åˆ° Zeabur æ™‚ï¼š

```
1. Zeabur è®€å– Dockerfile
2. åŸ·è¡Œä»¥ä¸‹æ­¥é©Ÿ:
   
   âœ“ FROM node:18-alpine (å®‰è£ Node.js)
   âœ“ è¤‡è£½ package.json
   âœ“ npm ci (å®‰è£ä¾è³´)
   âœ“ npm run build (æ§‹å»ºå‰ç«¯)
   âœ“ npm ci --only=production (å®‰è£ç”Ÿç”¢ä¾è³´)
   âœ“ è¤‡è£½å‰ç«¯ dist/
   âœ“ è¤‡è£½å¾Œç«¯ server/
   
3. å•Ÿå‹•æ‡‰ç”¨:
   CMD ["node", "server/index.js"]
```

### å¯¦éš›æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Zeabur å®¹å™¨å•Ÿå‹•                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
        node server/index.js
                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                    â–¼
    Express å•Ÿå‹•        æƒæ /dist/
    ç›£è½ 3001              å‰ç«¯æ–‡ä»¶
        â”‚                   â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¤
        â–¼           â–¼
    âœ“ API        âœ“ Frontend
    /api/*       /
    /api/auth    /patients
    /api/patients /appointments
    ...          ...
```

---

## ğŸ“Š æ”¹é€²çš„ server/index.js

å·²ç‚ºæ‚¨ä¿®æ”¹äº† `server/index.js`ï¼Œç¾åœ¨åŒ…å«ï¼š

### âœ… æ–°å¢åŠŸèƒ½

1. **å‰ç«¯éœæ…‹æ–‡ä»¶æœå‹™**
   ```javascript
   app.use(express.static(distPath));
   ```

2. **React Router æ”¯æ´**
   ```javascript
   // æ‰€æœ‰é API è«‹æ±‚é‡å®šå‘åˆ° index.html
   app.get('*', (req, res) => {
     res.sendFile(indexPath);
   });
   ```

3. **æ›´å¥½çš„æ—¥èªŒè¼¸å‡º**
   ```
   Patient CRM Backend & Frontend
   Status: âœ“ Running
   Backend API Port: 3001
   Frontend URL: http://0.0.0.0:3001
   ```

4. **å„ªé›…é—œé–‰**
   ```javascript
   process.on('SIGTERM', () => { ... });
   process.on('SIGINT', () => { ... });
   ```

---

## ğŸ”„ å•Ÿå‹•é †åº

### æœ¬åœ°é–‹ç™¼
```bash
# æ–¹æ³• 1: åŒæ™‚å•Ÿå‹• (æ¨è–¦)
npm run dev:full

# é€™æœƒåŸ·è¡Œ:
# - npm run server:dev  (Express å¾Œç«¯)
# - npm run dev         (Vite å‰ç«¯ç†±æ›´æ–°)
```

### Zeabur éƒ¨ç½²
```bash
# Zeabur è‡ªå‹•åŸ·è¡Œ
npm run build           # æ§‹å»ºå‰ç«¯
node server/index.js    # å•Ÿå‹•å¾Œç«¯ + éœæ…‹æ–‡ä»¶æœå‹™
```

---

## ğŸŒ è¨ªå•æ–¹å¼

### æœ¬åœ°é–‹ç™¼

| åŠŸèƒ½ | URL | èªªæ˜ |
|------|-----|------|
| å‰ç«¯ | http://localhost:5173 | Vite é–‹ç™¼ä¼ºæœå™¨ |
| å¾Œç«¯ API | http://localhost:3001 | Express API |
| å‰ç«¯ (éœæ…‹) | http://localhost:3001 | Express æœå‹™çš„å‰ç«¯ |

### Zeabur éƒ¨ç½²

| åŠŸèƒ½ | URL | èªªæ˜ |
|------|-----|------|
| å‰ç«¯ + API | https://your-app.zeabur.app | Express åŒæ™‚æœå‹™ |
| API | https://your-app.zeabur.app/api | æ‰€æœ‰ API ç«¯é» |

---

## ğŸ¯ æ–‡ä»¶æ§‹æˆ

### æ§‹å»ºå‰
```
Patient_CRM/
â”œâ”€â”€ src/                    # React æºä»£ç¢¼
â”‚   â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ components/
â”‚   â””â”€â”€ main.tsx
â”œâ”€â”€ server/                 # Express å¾Œç«¯
â”‚   â”œâ”€â”€ index.js           # ä¸»ä¼ºæœå™¨æ–‡ä»¶ (å·²æ”¹é€²)
â”‚   â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ routes/
â”‚   â””â”€â”€ middleware/
â”œâ”€â”€ package.json
â”œâ”€â”€ Dockerfile
â””â”€â”€ vite.config.ts
```

### æ§‹å»ºå¾Œ (Zeabur å®¹å™¨ä¸­)
```
/app/
â”œâ”€â”€ dist/                   # å‰ç«¯éœæ…‹æ–‡ä»¶
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ assets/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ server/                 # å¾Œç«¯ä»£ç¢¼
â”‚   â”œâ”€â”€ index.js
â”‚   â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ routes/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ node_modules/
â”œâ”€â”€ package.json
â””â”€â”€ data/
    â””â”€â”€ patient_crm.db
```

---

## âœ… Zeabur éƒ¨ç½²æª¢æŸ¥æ¸…å–®

### æ§‹å»ºéšæ®µ (è‡ªå‹•)
- [ ] Dockerfile è¢«è®€å–
- [ ] npm ä¾è³´å·²å®‰è£
- [ ] React å‰ç«¯å·²æ§‹å»º â†’ dist/
- [ ] ç”Ÿç”¢ä¾è³´å·²å®‰è£

### é‹è¡Œéšæ®µ (è‡ªå‹•)
- [ ] Express ä¼ºæœå™¨å•Ÿå‹•
- [ ] å¾Œç«¯ API å¯ç”¨ (/api/*)
- [ ] å‰ç«¯éœæ…‹æ–‡ä»¶å¯ç”¨ (/)
- [ ] æ•¸æ“šåº«é€£æ¥æˆåŠŸ

### é©—è­‰ (æ‚¨éœ€è¦åš)
1. è¨ªå• https://your-app.zeabur.app
   - æ‡‰çœ‹åˆ°ç™»å…¥é é¢

2. æ‰“é–‹ç€è¦½å™¨é–‹ç™¼è€…å·¥å…· (F12)
   - æŸ¥çœ‹ Network æ¨™ç±¤
   - ç¢ºèª API è«‹æ±‚æˆåŠŸ

3. ç™»å…¥æ¸¬è©¦
   - ç”¨æˆ¶å: admin
   - å¯†ç¢¼: Admin123

---

## ğŸ”§ å®¹å™¨å…§é‹è¡Œæµç¨‹

### Zeabur å®¹å™¨ä¸­ç™¼ç”Ÿçš„äº‹æƒ…

```
1. å®¹å™¨å•Ÿå‹•
   â””â”€ CMD ["node", "server/index.js"]

2. server/index.js åŸ·è¡Œ:
   â”œâ”€ åˆå§‹åŒ– Express æ‡‰ç”¨
   â”œâ”€ é…ç½® CORS å’Œä¸­ä»‹å±¤
   â”œâ”€ åˆå§‹åŒ–æ•¸æ“šåº«
   â”œâ”€ æ›è¼‰ API è·¯ç”±
   â”œâ”€ æ›è¼‰éœæ…‹æ–‡ä»¶æœå‹™ (dist/)
   â”œâ”€ é…ç½® React Router å›é€€è·¯ç”±
   â””â”€ ç›£è½ 0.0.0.0:3001

3. ç”¨æˆ¶è¨ªå•æ‡‰ç”¨:
   â”œâ”€ GET / 
   â”‚   â””â”€ Express æœå‹™ dist/index.html (React æ‡‰ç”¨)
   â”‚
   â”œâ”€ GET /patients
   â”‚   â””â”€ Express åŠ è¼‰ dist/index.html (React Router è™•ç†)
   â”‚
   â”œâ”€ GET /api/patients
   â”‚   â””â”€ Express è¿”å› JSON æ•¸æ“š (API è·¯ç”±)
   â”‚
   â””â”€ GET /assets/...
       â””â”€ Express æœå‹™ dist/assets/ ä¸­çš„æ–‡ä»¶
```

---

## ğŸ†˜ å¸¸è¦‹å•é¡Œ

### Q1: ç‚ºä»€éº¼éœ€è¦å…©å€‹æœå‹™ï¼Ÿ

**A**: 
- **å‰ç«¯**: React SPA éœ€è¦åœ¨ç€è¦½å™¨ä¸­é‹è¡Œ
- **å¾Œç«¯**: API æœå‹™éœ€è¦åœ¨ä¼ºæœå™¨ä¸­é‹è¡Œ
- **Integration**: Express åŒæ™‚æœå‹™å‰ç«¯å’Œ API

### Q2: Zeabur æœƒè‡ªå‹•å•Ÿå‹•å—ï¼Ÿ

**A**: æ˜¯çš„ï¼Zeabur æœƒï¼š
1. è®€å– Dockerfile
2. åŸ·è¡Œ `npm run build`ï¼ˆæ§‹å»ºå‰ç«¯ï¼‰
3. åŸ·è¡Œ `node server/index.js`ï¼ˆå•Ÿå‹•å¾Œç«¯ï¼‰
4. è‡ªå‹•ç‚ºæ‚¨ç®¡ç†ä¸€åˆ‡

### Q3: éœ€è¦é‹è¡Œå…©å€‹ npm å‘½ä»¤å—ï¼Ÿ

**A**: 
- **æœ¬åœ°é–‹ç™¼**: `npm run dev:full`ï¼ˆåŒæ™‚é‹è¡Œ Vite + Expressï¼‰
- **Zeabur éƒ¨ç½²**: ä¸€åˆ‡è‡ªå‹•åŒ–

### Q4: å¦‚ä½•ç¢ºèªå…©å€‹éƒ½åœ¨é‹è¡Œï¼Ÿ

**A**: 
```bash
# æœ¬åœ°æ¸¬è©¦
curl http://localhost:3001/api/health-check
# æ‡‰è¿”å›: { "status": "ok", "timestamp": "..." }

curl http://localhost:3001/
# æ‡‰è¿”å› React æ‡‰ç”¨çš„ HTML
```

### Q5: å¦‚æœå‰ç«¯ç„¡æ³•åŠ è¼‰æ€éº¼è¾¦ï¼Ÿ

**A**: 
1. æª¢æŸ¥ `dist/` æ˜¯å¦å­˜åœ¨
2. é‹è¡Œ `npm run build`
3. æŸ¥çœ‹ Zeabur æ—¥èªŒï¼š
   - ğŸŸ¢ å¦‚æœæˆåŠŸ: `âœ“ é›™æœå‹™å·²å•Ÿå‹•`
   - ğŸ”´ å¦‚æœå¤±æ•—: æŸ¥çœ‹éŒ¯èª¤ä¿¡æ¯

---

## ğŸ“ˆ æ€§èƒ½å„ªåŒ–

### å·²åŒ…å«çš„å„ªåŒ–

âœ… **å¤šéšæ®µ Docker æ§‹å»º**
- æ¸›å°æœ€çµ‚é¡åƒå¤§å°
- åˆ†é›¢æ§‹å»ºç’°å¢ƒå’Œé‹è¡Œç’°å¢ƒ

âœ… **éœæ…‹æ–‡ä»¶ç·©å­˜**
- Express è‡ªå‹•æä¾›æ­£ç¢ºçš„ Cache-Control é ­

âœ… **React Router æ”¯æ´**
- æ‰€æœ‰è·¯ç”±éƒ½èƒ½æ­£ç¢ºå·¥ä½œ
- åˆ·æ–°ä¸æœƒ 404

âœ… **CORS é…ç½®**
- API è·¨åŸŸè«‹æ±‚æ”¯æŒ
- é–‹ç™¼å’Œç”Ÿç”¢éƒ½å¯ç”¨

---

## ğŸš€ å®Œæ•´éƒ¨ç½²æµç¨‹

### ç¬¬ 1 æ­¥ï¼šæäº¤ä»£ç¢¼
```bash
git add .
git commit -m "Update server with frontend static serving"
git push origin main
```

### ç¬¬ 2 æ­¥ï¼šZeabur è‡ªå‹•éƒ¨ç½²
```
1. Zeabur æª¢æ¸¬åˆ°æ¨é€
2. æ‹‰å–æœ€æ–°ä»£ç¢¼
3. åŸ·è¡Œ Dockerfile:
   - npm run build (æ§‹å»ºå‰ç«¯)
   - node server/index.js (å•Ÿå‹•ä¼ºæœå™¨)
```

### ç¬¬ 3 æ­¥ï¼šè¨ªå•æ‡‰ç”¨
```
https://your-app.zeabur.app
â†“
Express ä¼ºæœå™¨æ¥æ”¶è«‹æ±‚
â†“
â”œâ”€ API è«‹æ±‚ â†’ API è·¯ç”±
â”œâ”€ é é¢è«‹æ±‚ â†’ React æ‡‰ç”¨
â””â”€ è³‡æºè«‹æ±‚ â†’ éœæ…‹æ–‡ä»¶
```

---

## ğŸ“‹ ç¸½çµ

| é …ç›® | èªªæ˜ |
|------|------|
| **å‰ç«¯** | React SPAï¼Œç”± Express æœå‹™ |
| **å¾Œç«¯** | Node.js Express API ä¼ºæœå™¨ |
| **é‹è¡Œæ¨¡å¼** | å–®ä¸€é€²ç¨‹ï¼Œä¸€å€‹ç«¯å£ (3001) |
| **è‡ªå‹•å•Ÿå‹•** | âœ… æ˜¯çš„ï¼ŒZeabur æœƒè‡ªå‹•å‡¦ç† |
| **æœ¬åœ°é–‹ç™¼** | `npm run dev:full` |
| **éƒ¨ç½²** | `git push` è‡ªå‹•éƒ¨ç½² |

---

## âœ¨ å·²æ”¹é€²çš„åŠŸèƒ½

1. âœ… å‰ç«¯éœæ…‹æ–‡ä»¶æœå‹™
2. âœ… React Router æ”¯æ´
3. âœ… æ›´å¥½çš„æ—¥èªŒè¼¸å‡º
4. âœ… å„ªé›…é—œé–‰æ©Ÿåˆ¶
5. âœ… API ä¸å­˜åœ¨æ™‚è¿”å› 404

**æ‚¨çš„ç³»çµ±å·²å®Œå…¨æº–å‚™å¥½éƒ¨ç½²ï¼** ğŸ‰

æ¨é€ä»£ç¢¼ï¼ŒZeabur æœƒè‡ªå‹•è™•ç†å…¶é¤˜éƒ¨åˆ†ã€‚
